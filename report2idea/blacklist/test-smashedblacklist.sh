#!/bin/bash

# input data:
# (created by json_replay.py -i f:/dev/stdout -f aggregated_blacklist | gzip | base64)
in='
H4sIAAAAAAAAA62W3W7bMAyFk+1yt3uAwrstBJEi9bMnGVAUXpqlmbGsCWwXRTHkmfcKoxw0i1Nq
a5r6JgglkfKn4yO+nwzPx9ly2S6Ws37xrb5ZzeY/Vk3XTyYffr/79Kvq2nndLe76+uaxX3TV5wsI
zlK4vKg27bpfz9criXn5263v2/mi3qzbPk+7YnkuL0ieaxntu3o16/q8nik5IE/BxIB5aNnvKmyk
9GJYDEScUz7Vvl2tH4Z4LtTP2uVu2lUFCQ34aNBaQ66S0cOIS4cR8N7AKJCSAYvHq/w4EOR3vCxK
5jiKQDjK7MkEHNeykms8CXKYq+s9PHmlcWE77GUP6AkD2h3R26Y9RAqyhDkj2p9i3XzL4xglKKdc
PzR39c/m7n53lGyGRI+boXKzqQ6Z/z2N4P3hLvZCQGdt3E5XikiQhz3+RyLRI6jiEOkYDKyLw2nK
wIIwHOQzHWEPwSBhATskZ1iFDipzBjTO8nPmZxHHoAJnr9OGgPgC2lb/ECEZhKCzBtJghwJsiCB4
RyIPbIqs5fNLOmtWWTtykgyfs/Z0DmwAFTaw204bhfaRsAd0x6ydA502g7yDJZ226nm2BDt4E0eW
J4FsZwVhh2R0N3EF2NnlwnPYDs+BbTXWiHY7/fJa1JaSfsWwXDGp5CJwCmt0JACLTp2t/RTP2O/r
LT1DJeso6GThJf6MPlpW0RJF40M8Aa0ryTiBIV9AG1k8JZ6AlgQtDXbwlmidhpZxO/2ukWWfXm3G
5J3xFnSuqj0ULz5vwqj9QeDcEBXcAY3HEzg7b8W+Fc7nuYPaZ0SbttOvCmnnYuKXtBkl1gJlOCtN
w0FtM+BfKi7Cze2hTXorp8sYg/HxrWWMxBpfaRuJtpOp/QPzJleTDwwAAA==
'

# output data:
out='
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
AA==
'

blconfig="
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
P3M111h/IfqTx1ijCYfB1P9Y/QuhfCd2mzUAAA==
"

prefixes='[{"id":1, "ip_prefix":"10.0.0.0/29"},
{"id":1, "ip_prefix":"192.168.117.0/24"}]'

configfile="`mktemp`"
echo "$blconfig" | base64 -d | gunzip > "$configfile"

prefixesfile="`mktemp`"
echo "$prefixes" > "$prefixesfile"

test -z "$srcdir" && export srcdir=.

. $srcdir/../test.sh

test_conversion "smashedblacklist" "smashedblacklist" "$in" "$out" --blacklist-config "$configfile" --prefixes "$prefixesfile"
result=$?

rm "$configfile" "$prefixesfile"

exit $result

