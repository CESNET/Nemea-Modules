#!/bin/bash

# input data:
# (created by json_replay.py -i f:/dev/stdout -f aggregated_blacklist | gzip | base64)
in='
H4sIAAAAAAAAA62W3W7bMAyFk+1yt3uAwrstBJEi9bMnGVAUXpqlmbGsCWwXRTHkmfcKoxw0i1Nq
a5r6JgglkfKn4yO+nwzPx9ly2S6Ws37xrb5ZzeY/Vk3XTyYffr/79Kvq2nndLe76+uaxX3TV5wsI
zlK4vKg27bpfz9criXn5263v2/mi3qzbPk+7YnkuL0ieaxntu3o16/q8nik5IE/BxIB5aNnvKmyk
9GJYDEScUz7Vvl2tH4Z4LtTP2uVu2lUFCQ34aNBaQ66S0cOIS4cR8N7AKJCSAYvHq/w4EOR3vCxK
5jiKQDjK7MkEHNeykms8CXKYq+s9PHmlcWE77GUP6AkD2h3R26Y9RAqyhDkj2p9i3XzL4xglKKdc
PzR39c/m7n53lGyGRI+boXKzqQ6Z/z2N4P3hLvZCQGdt3E5XikiQhz3+RyLRI6jiEOkYDKyLw2nK
wIIwHOQzHWEPwSBhATskZ1iFDipzBjTO8nPmZxHHoAJnr9OGgPgC2lb/ECEZhKCzBtJghwJsiCB4
RyIPbIqs5fNLOmtWWTtykgyfs/Z0DmwAFTaw204bhfaRsAd0x6ydA502g7yDJZ226nm2BDt4E0eW
J4FsZwVhh2R0N3EF2NnlwnPYDs+BbTXWiHY7/fJa1JaSfsWwXDGp5CJwCmt0JACLTp2t/RTP2O/r
LT1DJeso6GThJf6MPlpW0RJF40M8Aa0ryTiBIV9AG1k8JZ6AlgQtDXbwlmidhpZxO/2ukWWfXm3G
5J3xFnSuqj0ULz5vwqj9QeDcEBXcAY3HEzg7b8W+Fc7nuYPaZ0SbttOvCmnnYuKXtBkl1gJlOCtN
w0FtM+BfKi7Cze2hTXorp8sYg/HxrWWMxBpfaRuJtpOp/QPzJleTDwwAAA==
'

# output data:
out='H4sIAPd7vV8AA+2ZT2/bNhjG7/sUgk4tYDIkJf7TrUtaoIcGwRKgwIIeSIpKtNmSIckp0qDffSTl
xJKLxopnoB6WXBJRL0np0fPj+5J5iE9VZ2/q5j7Oouv4ctUuS1PWqxZ+KivbxF9mUfyhbhaqc/fj
j2fv36F45v/wl4Lm0nJhQFEQBdIiT4BWBQdIaCS10UYlIfq0sW6Sq3JhfS+CCAIYA5JeEZwRkVH0
p496f2erbhOEJUAEoBCEcJbyEHRmO2t+EoXRY9SpVa3dFXRmW9OUy66sKx92Ubdtqec2Om3ul119
umoaW5n7aFFWZXUTlbl7urIobR7p+8jUVeWew3WNvpbdbaQew5Z1PYd+9Mt61Rg///VDfNHUXR30
7cwySHp1vwzP1ovsBb1IQwCWBGImIEEIpom/M2xJ5LAFMwbxqEFKiBHZ7sXGDdz9HncTbmQxasF8
a2SWQk7GcyE31jgI+2Yaf/keXlE1N7b7mQA/vq+bEbFtcZykF07ROIx4XudrQc9V/2nNN2hsW9kO
VnZhFWwXqr21uZ4r8/e8bLvwIT6Hic59gL9+ulmU827t8Hc3N83nMtgAoQzRDAXfrh/kOv4wr7/6
ht+fBu7f8Q9bhPu3XbfMTk7W08Oi7ODdqtMNNN8ygQQ66d3hZFie/NU6v/Wv04WX6C3tfLV83oHO
dh8vorFBZtHYHpvrYI7BZW+NcTwbXgZbDDoEUwyuvSWGw3tDDMcPdhjGBzPMIm2NWrU2qouo1q1t
7tybmnqxWFWlURuCtoyQUfczi1L3E3nBXSfVjjGLwmBN9MYJ035Sl7f2LIT6mUxQ0Gwp6Hu1b2H8
/beHf7PsqYQrRKwAWHMD0pwjoFlCQSql0EIoSg0+zLInsoTsXPaQzDDdtextgo562UuwN+ZoUeEc
kpTstahgmUD6uqRMXVJ68QcI99K/GOEgeyYYwUeHLlOaW+aKFSWMBxYZoAm1rnYhRc5smkhOD4Mu
zdJkSsWC5YSKZR101OhigZ1jRgUBp3BPcl22kq/kTiZ3rf0G3aD8i8ENqrtnPDpsORdMcC1AkvPU
ZVzNgTaUAcqLglvEte2L04Ngi3ZnXJeXk50Z9ynoV2C7yqdiyxkUo42Ga/CbiOewfRz9x8EkfK3h
p2MbtB9Qy/oa/aX51qvuzIaPD1ySG5dSUws0l9Ll21wAmSYK5MY9fMHy3KDiMODKDO0+IdhEPV8q
o193QjAZXJKk7svvhanf+xH0yunkvXaQeo+trJc5S1Aqj28TawSmHBsEpPFkpiwHKhHKlcNORFMk
ibb2MGTyjEwg00WJnWQ+BR13JSwxTNleda+grpYTr2ROzqBB6heT2cucESYQPToysRXaJGkBcokc
mXlBgUSUAyaZS6a5Kaw9UM5k7gtPITPdXezyzXb3iMlMGOSjI3SCqT9U3+twiUBGXkmdfLjkpR+c
NwfhX17qetGPc4dqlaGmAAkxGqTCkStpjgDXmhgmqUbIHCqdTil0HY9T0mn6X0mnntFZNIlL/48K
JP+PZA4TY69CpCrPadO9ad9GDpuyPTQ5szDFdkqWA4jdZMEY3a2b3c9SGhuBzeqx8B/eA/gP7WfL
kIweAAA='

blconfig="
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
P3M111h/IfqTx1ijCYfB1P9Y/QuhfCd2mzUAAA==
"

prefixes='[{"id":1, "ip_prefix":"10.0.0.0/29"},
{"id":1, "ip_prefix":"192.168.117.0/24"}]'

configfile="`mktemp`"
echo "$blconfig" | base64 -d | gunzip > "$configfile"

prefixesfile="`mktemp`"
echo "$prefixes" > "$prefixesfile"

test -z "$srcdir" && export srcdir=.

. $srcdir/../test.sh

test_conversion "smashedblacklist" "smashedblacklist" "$in" "$out" --blacklist-config "$configfile" --prefixes "$prefixesfile"
result=$?

rm "$configfile" "$prefixesfile"

exit $result

